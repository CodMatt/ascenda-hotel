<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bookings</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/booking.css" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    
    <!-- Datepicker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Booking Form</h1>
        
        <form id="booking-form">
            <!-- Hidden fields -->
            <input type="hidden" id="booking-id" name="booking_id">
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="destination-id" class="form-label">Destination ID</label>
                    <input type="text" class="form-control" id="destination-id" name="destination_id" required>
                </div>
                <div class="col-md-6">
                    <label for="hotel-id" class="form-label">Hotel ID</label>
                    <input type="text" class="form-control" id="hotel-id" name="hotel_id" required>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="nights" class="form-label">Number of Nights</label>
                    <input type="number" class="form-control" id="nights" name="nights" min="1" required>
                </div>
                <div class="col-md-4">
                    <label for="start-date" class="form-label">Start Date</label>
                    <input type="text" class="form-control datepicker" id="start-date" name="start_date" required>
                </div>
                <div class="col-md-4">
                    <label for="end-date" class="form-label">End Date</label>
                    <input type="text" class="form-control datepicker" id="end-date" name="end_date" required>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="adults" class="form-label">Number of Adults</label>
                    <input type="number" class="form-control" id="adults" name="adults" min="1" required>
                </div>
                <div class="col-md-6">
                    <label for="children" class="form-label">Number of Children</label>
                    <input type="number" class="form-control" id="children" name="children" min="0" value="0">
                </div>
            </div>
            
            <div class="mb-3">
                <label for="msg-to-hotel" class="form-label">Special Requests</label>
                <textarea class="form-control" id="msg-to-hotel" name="msg_to_hotel" rows="3"></textarea>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="price" class="form-label">Price</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" id="price" name="price" min="0" step="0.01" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="booking-reference" class="form-label">Booking Reference</label>
                    <input type="text" class="form-control" id="booking-reference" name="booking_reference" required>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="button" class="btn btn-secondary me-md-2" id="cancel-btn">Cancel</button>
                <button type="submit" class="btn btn-primary" id="submit-btn">Submit Booking</button>
            </div>
        </form>
        
        <!-- Bookings List -->
        <div class="mt-5">
            <h2 class="mb-3">Existing Bookings</h2>
            <div id="all-bookings-anchor"></div>
            
            <script id="all-bookings-template" type="text/x-handlebars-template">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Booking Ref</th>
                            <th>Destination</th>
                            <th>Hotel</th>
                            <th>Dates</th>
                            <th>Guests</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each bookings}}
                        <tr>
                            <td>{{booking_reference}}</td>
                            <td>{{destination_id}}</td>
                            <td>{{hotel_id}}</td>
                            <td>{{start_date}} to {{end_date}} ({{nights}} nights)</td>
                            <td>{{adults}} adults, {{children}} children</td>
                            <td>${{price}}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-booking-btn" data-booking-id="{{booking_id}}">Edit</button>
                                <button class="btn btn-sm btn-danger delete-booking-btn" data-booking-id="{{booking_id}}">Delete</button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </script>
        </div>
    </div>

    <script src="scripts/http.js"></script>
    <script src="scripts/booking.js"></script>
    <script>
        // Initialize date pickers
        flatpickr(".datepicker", {
            dateFormat: "Y-m-d",
            minDate: "today"
        });
        
        // Calculate end date based on start date and nights
        document.getElementById('nights').addEventListener('change', updateEndDate);
        document.getElementById('start-date').addEventListener('change', updateEndDate);
        
        function updateEndDate() {
            const startDate = document.getElementById('start-date').value;
            const nights = parseInt(document.getElementById('nights').value);
            
            if (startDate && nights) {
                const start = new Date(startDate);
                const end = new Date(start);
                end.setDate(start.getDate() + nights);
                
                // Format as YYYY-MM-DD
                const endStr = end.toISOString().split('T')[0];
                document.getElementById('end-date').value = endStr;
            }
        }
    </script>
</body>
</html>